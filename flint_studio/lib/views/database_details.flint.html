<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlintStudio Database Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Sora', 'ui-sans-serif', 'system-ui', 'sans-serif']
          }
        }
      }
    };
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen bg-slate-950 text-slate-100">
  <div class="relative min-h-screen">
    <div class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top_left,rgba(56,189,248,0.18),transparent_32%),radial-gradient(circle_at_80%_0%,rgba(251,146,60,0.14),transparent_30%),radial-gradient(circle_at_bottom_right,rgba(59,130,246,0.18),transparent_30%)]"></div>

    <div class="relative mx-auto flex min-h-screen max-w-7xl flex-col md:flex-row">
      <aside class="w-full border-b border-white/10 bg-slate-900/70 p-5 backdrop-blur-xl md:sticky md:top-0 md:h-screen md:w-72 md:overflow-y-auto md:border-b-0 md:border-r">
        <div class="mb-8 rounded-2xl border border-white/10 bg-white/5 p-4">
          <p class="text-[10px] uppercase tracking-[0.3em] text-cyan-300">Flint Studio</p>
          <h1 class="mt-2 text-2xl font-extrabold">Control Panel</h1>
          <p class="mt-1 text-xs text-slate-400">Multi-profile connection manager</p>
        </div>

        <nav class="space-y-2">
          <a class="block rounded-xl border px-4 py-3 text-sm font-semibold transition {{ activePage == 'dashboard' ? 'border-cyan-300/40 bg-cyan-300/15 text-cyan-100' : 'border-transparent text-slate-300 hover:border-white/10 hover:bg-white/5' }}" href="/?profile={{ currentProfileId }}">Dashboard</a>
          <a class="block rounded-xl border px-4 py-3 text-sm font-semibold transition {{ activePage == 'databases' ? 'border-cyan-300/40 bg-cyan-300/15 text-cyan-100' : 'border-transparent text-slate-300 hover:border-white/10 hover:bg-white/5' }}" href="/databases?profile={{ currentProfileId }}">Databases</a>
          <a class="block rounded-xl border px-4 py-3 text-sm font-semibold transition {{ activePage == 'query' ? 'border-cyan-300/40 bg-cyan-300/15 text-cyan-100' : 'border-transparent text-slate-300 hover:border-white/10 hover:bg-white/5' }}" href="/query?profile={{ currentProfileId }}">SQL Query</a>
        </nav>
      </aside>

      <main class="flex-1 space-y-6 p-6 md:p-10">
        <header class="rounded-3xl border border-white/10 bg-gradient-to-r from-sky-500/20 via-cyan-400/10 to-amber-400/15 p-6 shadow-2xl backdrop-blur-xl">
          <div class="flex flex-wrap items-end justify-between gap-4">
            <div>
              <p class="text-xs uppercase tracking-[0.28em] text-cyan-200">Database Workspace</p>
              <h2 class="mt-2 text-3xl font-extrabold tracking-tight text-cyan-100">{{ databaseName }}</h2>
              <p class="mt-2 text-sm text-slate-300">Profile: {{ currentProfileName }} | Driver: {{ currentDriver }}</p>
            </div>
            <a href="/databases?profile={{ currentProfileId }}" class="rounded-xl border border-white/20 bg-white/5 px-4 py-2 text-sm font-semibold text-slate-100 transition hover:bg-white/10">Back</a>
          </div>
        </header>

        {{ if successMessage != '' }}<section class="rounded-xl border border-emerald-300/40 bg-emerald-400/10 px-4 py-3 text-sm text-emerald-100">{{ successMessage }}</section>{{ endif }}
        {{ if errorMessage != '' }}<section class="rounded-xl border border-rose-300/40 bg-rose-400/10 px-4 py-3 text-sm text-rose-100">{{ errorMessage }}</section>{{ endif }}

        <section class="rounded-2xl border border-white/10 bg-slate-900/70 p-6">
          <h3 class="text-lg font-bold text-amber-200">Import .sql Into This Database</h3>
          <form method="POST" action="/import-sql" enctype="multipart/form-data" class="mt-4 space-y-3">
            <input type="hidden" name="profile_id" value="{{ currentProfileId }}" />
            <input type="hidden" name="database_name" value="{{ databaseName }}" />
            <input type="file" name="sql_file" accept=".sql,text/plain" required class="w-full rounded-xl border border-white/15 bg-slate-950/85 px-3 py-2 text-sm file:mr-3 file:rounded-lg file:border-0 file:bg-amber-300 file:px-3 file:py-1 file:text-xs file:font-semibold file:text-slate-950" />
            <button type="submit" class="rounded-xl bg-amber-300 px-4 py-2 text-sm font-semibold text-slate-950 transition hover:bg-amber-200">Import SQL</button>
          </form>
        </section>

        <section class="grid gap-4 md:grid-cols-3">
          <article class="rounded-2xl border border-white/10 bg-slate-900/70 p-5"><p class="text-xs uppercase tracking-[0.2em] text-slate-400">Tables</p><p class="mt-2 text-3xl font-extrabold text-cyan-200">{{ tableCount }}</p></article>
          <article class="rounded-2xl border border-white/10 bg-slate-900/70 p-5"><p class="text-xs uppercase tracking-[0.2em] text-slate-400">Triggers</p><p class="mt-2 text-3xl font-extrabold text-amber-200">{{ triggerCount }}</p></article>
          <article class="rounded-2xl border border-white/10 bg-slate-900/70 p-5"><p class="text-xs uppercase tracking-[0.2em] text-slate-400">Users</p><p class="mt-2 text-3xl font-extrabold text-indigo-200">{{ usersCount }}</p></article>
        </section>

        <section class="grid gap-6 xl:grid-cols-2">
          <article class="rounded-2xl border border-white/10 bg-slate-900/70 p-6">
            <h3 class="text-lg font-bold text-cyan-200">Create Table</h3>
            <form method="POST" action="/databases/{{ databaseName }}/tables" class="mt-4 space-y-3">
              <input type="hidden" name="profile_id" value="{{ currentProfileId }}" />
              <input type="text" name="table_name" required placeholder="table_name" class="w-full rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-cyan-300/50 placeholder:text-slate-500 focus:ring" />
              <textarea name="columns_sql" rows="6" required class="w-full rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 font-mono text-xs outline-none ring-cyan-300/50 placeholder:text-slate-500 focus:ring">id INT PRIMARY KEY AUTO_INCREMENT, name VARCHAR(255) NOT NULL</textarea>
              <button type="submit" class="rounded-xl bg-cyan-300 px-4 py-2 text-sm font-semibold text-slate-950 transition hover:bg-cyan-200">Create Table</button>
            </form>
          </article>

          <article class="rounded-2xl border border-white/10 bg-slate-900/70 p-6">
            <h3 class="text-lg font-bold text-amber-200">Create Trigger (MySQL)</h3>
            {{ if currentDriver == 'postgres' }}
              <p class="mt-3 rounded-xl border border-amber-300/40 bg-amber-400/10 px-4 py-3 text-sm text-amber-100">PostgreSQL trigger helper is disabled. Use SQL Query page.</p>
            {{ else }}
              <form method="POST" action="/databases/{{ databaseName }}/triggers" class="mt-4 space-y-3">
                <input type="hidden" name="profile_id" value="{{ currentProfileId }}" />
                <input type="text" name="trigger_name" required placeholder="trigger_name" class="w-full rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-amber-300/50 placeholder:text-slate-500 focus:ring" />
                <div class="grid grid-cols-1 gap-3 md:grid-cols-2"><select name="timing" class="rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-amber-300/50 focus:ring"><option value="BEFORE">BEFORE</option><option value="AFTER">AFTER</option></select><select name="event" class="rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-amber-300/50 focus:ring"><option value="INSERT">INSERT</option><option value="UPDATE">UPDATE</option><option value="DELETE">DELETE</option></select></div>
                <input type="text" name="table_name" required placeholder="target_table_name" class="w-full rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-amber-300/50 placeholder:text-slate-500 focus:ring" />
                <textarea name="statement_sql" rows="4" required class="w-full rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 font-mono text-xs outline-none ring-amber-300/50 placeholder:text-slate-500 focus:ring">SET NEW.updated_at = NOW()</textarea>
                <button type="submit" class="rounded-xl bg-amber-300 px-4 py-2 text-sm font-semibold text-slate-950 transition hover:bg-amber-200">Create Trigger</button>
              </form>
            {{ endif }}
          </article>
        </section>

        <section class="rounded-2xl border border-white/10 bg-slate-900/70 p-6">
          <h3 class="text-lg font-bold text-indigo-200">Create User</h3>
          <form method="POST" action="/databases/{{ databaseName }}/users" class="mt-4 grid gap-3 md:grid-cols-4">
            <input type="hidden" name="profile_id" value="{{ currentProfileId }}" />
            <input type="text" name="username" required placeholder="username" class="rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-indigo-300/50 placeholder:text-slate-500 focus:ring" />
            <input type="password" name="password" required placeholder="password" class="rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-indigo-300/50 placeholder:text-slate-500 focus:ring" />
            <input type="text" name="host" placeholder="%" value="%" class="rounded-xl border border-white/15 bg-slate-950/85 px-4 py-2 text-sm outline-none ring-indigo-300/50 placeholder:text-slate-500 focus:ring" />
            <label class="inline-flex items-center gap-2 rounded-xl border border-white/15 px-3 py-2 text-sm text-slate-200"><input type="checkbox" name="grant_all" class="accent-indigo-300" />Grant all on DB</label>
            <div class="md:col-span-4"><button type="submit" class="rounded-xl bg-indigo-300 px-4 py-2 text-sm font-semibold text-slate-950 transition hover:bg-indigo-200">Create User</button></div>
          </form>
        </section>

        <section class="overflow-hidden rounded-2xl border border-white/10 bg-slate-900/70">
          <header class="border-b border-white/10 bg-white/5 px-5 py-4"><h3 class="text-base font-semibold">Tables</h3></header>
          <div class="overflow-x-auto">
            <table class="min-w-full text-left text-sm">
              <thead class="text-slate-300">
                <tr><th class="px-5 py-3">Table</th><th class="px-5 py-3">Engine</th><th class="px-5 py-3">Rows</th><th class="px-5 py-3">Action</th></tr>
              </thead>
              <tbody class="divide-y divide-white/5">
                {{ if tableCount == 0 }}
                  <tr><td class="px-5 py-4 text-slate-400" colspan="4">No tables found.</td></tr>
                {{ else }}
                  {{ for table in tables }}
                    <tr class="transition hover:bg-white/5">
                      <td class="px-5 py-3"><a class="text-cyan-200 hover:underline" href="/databases/{{ databaseName }}/tables/{{ table.TABLE_NAME }}?profile={{ currentProfileId }}">{{ table.TABLE_NAME }}</a></td>
                      <td class="px-5 py-3">{{ table.ENGINE }}</td>
                      <td class="px-5 py-3">{{ table.TABLE_ROWS }}</td>
                      <td class="px-5 py-3">
                        <form method="POST" action="/databases/{{ databaseName }}/tables/{{ table.TABLE_NAME }}/drop" class="flex flex-wrap items-center gap-2" onsubmit="return confirm('Drop table {{ table.TABLE_NAME }}?')">
                          <input type="hidden" name="profile_id" value="{{ currentProfileId }}" />
                          <input type="text" name="confirm_name" required placeholder="Type {{ table.TABLE_NAME }}" class="w-40 rounded-lg border border-rose-300/30 bg-slate-950/70 px-2 py-1 text-xs text-rose-100 placeholder:text-rose-200/50" />
                          <button type="submit" class="rounded-lg border border-rose-300/40 bg-rose-300/10 px-3 py-1 text-xs font-semibold text-rose-100 hover:bg-rose-300/20">Drop</button>
                        </form>
                      </td>
                    </tr>
                  {{ endfor }}
                {{ endif }}
              </tbody>
            </table>
          </div>
        </section>

        <section class="overflow-hidden rounded-2xl border border-white/10 bg-slate-900/70"><header class="border-b border-white/10 bg-white/5 px-5 py-4"><h3 class="text-base font-semibold">Triggers</h3></header><div class="overflow-x-auto"><table class="min-w-full text-left text-sm"><thead class="text-slate-300"><tr><th class="px-5 py-3">Name</th><th class="px-5 py-3">Timing</th><th class="px-5 py-3">Event</th><th class="px-5 py-3">Table</th></tr></thead><tbody class="divide-y divide-white/5">{{ if triggerCount == 0 }}<tr><td class="px-5 py-4 text-slate-400" colspan="4">No triggers found.</td></tr>{{ else }}{{ for tr in triggers }}<tr class="transition hover:bg-white/5"><td class="px-5 py-3"><a class="text-amber-200 hover:underline" href="/databases/{{ databaseName }}/triggers/{{ tr.TRIGGER_NAME }}?profile={{ currentProfileId }}">{{ tr.TRIGGER_NAME }}</a></td><td class="px-5 py-3">{{ tr.ACTION_TIMING }}</td><td class="px-5 py-3">{{ tr.EVENT_MANIPULATION }}</td><td class="px-5 py-3">{{ tr.EVENT_OBJECT_TABLE }}</td></tr>{{ endfor }}{{ endif }}</tbody></table></div></section>

        <section class="overflow-hidden rounded-2xl border border-white/10 bg-slate-900/70"><header class="border-b border-white/10 bg-white/5 px-5 py-4"><h3 class="text-base font-semibold">Users</h3></header><div class="p-5">{{ if usersError != '' }}<p class="rounded-xl border border-amber-300/40 bg-amber-400/10 px-4 py-3 text-sm text-amber-100">{{ usersError }}</p>{{ endif }}{{ if usersCount == 0 }}<p class="mt-2 text-sm text-slate-400">No users available to display.</p>{{ else }}<div class="mt-2 grid gap-2 md:grid-cols-2">{{ for account in users }}<div class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-sm">{{ account.ACCOUNT }}</div>{{ endfor }}</div>{{ endif }}</div></section>
      </main>
    </div>
  </div>
</body>
</html>
